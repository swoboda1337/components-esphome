Not written by me, ported for someone else, WIP.